<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Watch</title>
</head>

<body style="margin:0;background:black;color:white;display:flex;align-items:center;justify-content:center;height:100vh;font-size:42px;">
  <div id="msg">CHECKING...</div>

  <script>
    const params = new URLSearchParams(location.search);
    const key = params.get("key");
    const msg = document.getElementById("msg");

    if (!key) { msg.innerText = "ACCESS DENIED"; throw new Error("no key"); }
    if (!key.startsWith("nfc-")) { msg.innerText = "ACCESS DENIED"; throw new Error("bad key"); }

    const ts = Number(key.replace("nfc-", ""));
    const ageMs = Date.now() - ts;
    const maxMs = 3 * 60 * 1000;

    if (!Number.isFinite(ts) || ageMs > maxMs) {
      msg.innerText = "EXPIRED";
      throw new Error("expired");
    }

    msg.innerText = "OPENING...";

    // ✅ 認証OKなら、Google Driveのpreviewへ移動（iPhoneで一番安定）
    location.href = "https://drive.google.com/file/d/1ST7-S3n3R-TpF4_Fb7mlqj3lHEKvm66q/preview";
  </script>
</body>
</html>
